<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bone Viewer</title>

    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <script type="module" src="/src/main.ts"></script>

    <button type="button" id="selected-bones" class="block hidden">
      <h2></h2>
      <img src="/search.svg" alt="info" />
    </button>

    <button type="button" id="show-info" class="block">
      <img src="/menu.svg" alt="info" />
    </button>

    <div id="info" class="hidden block">
      <h2>Bone Viewer</h2>
      <div id="env" class="hidden">
        <p>Environment:</p>
        <select id="env-select">
          <option value="env-2">Room</option>
          <option value="env-1">Sky</option>
          <option value="env-0">Gray</option>
        </select>
      </div>
      <div id="divider"></div>
      <p>Click on the bones to see their names.</p>
      <p>Click on the names to go to the detailed view of the bones.
      <p>Click on the menu icon to hide this message.</p>
      <div id="divider"></div>
      <h3>Controls</h3>
      <p>Press and drag to rotate the model.</p>
      <p>Scroll or pinch to zoom in and out.</p>
      <p>Press mouse right and drag to pan the model.</p>
      <div id="divider"></div>
      <p>Skeleton data from "BodyParts3D, Â© The Database Center for Life Science licensed under CC Attribution 4.0 International"</p>
    </div>

    <div id="loading">
      <div id="spinner"></div>
      <p>Loading...</p>
    </div>

    <div id="toggle-rt" class="block hidden off">
      <p>Ray Tracing <strong>OFF</strong></p>
    </div>

    <div id="modal" class="block hidden">
      <p>Click to toggle Ray Tracing</p>
      <br />
      <p><strong>Warning</strong>: Performance may be an issue. Wait untill it is activated.</p>
    </div>

    <div id="sample-count" class="block hidden">
      <p>Samples: 0</p>
    </div>

    <div id="back" class="hidden block">
      <img src="/arrow-back.svg" alt="info" />
    </div>

    <script>
      const env = document.getElementById('env');
      const env_select = document.getElementById('env-select');

      env_select.addEventListener('change', (event) => {
        const selectedEnv = event.target.value;
        if (selectedEnv === 'env-1') {
          dispatchEvent(new CustomEvent('set-env-1'));
        } else if (selectedEnv === 'env-2') {
          dispatchEvent(new CustomEvent('set-env-2'));
        } else if (selectedEnv === 'env-0') {
          dispatchEvent(new CustomEvent('set-env-0'));
        }
      });

      const toggle_rt = document.getElementById('toggle-rt');
      const rt_indicator = toggle_rt.querySelector('p strong');
      const back_button = document.getElementById('back');
      const sample_count = document.getElementById('sample-count');

      back_button.addEventListener('click', () => {
        toggle_rt.classList.add('hidden');
        back_button.classList.add('hidden');
        sample_count.classList.add('hidden');
        env.classList.add('hidden');
        env_select.value = 'env-2';
        dispatchEvent(new CustomEvent('quit-detailed-view'));
      });

      toggle_rt.addEventListener('mouseover', () => {
        document.getElementById('modal').classList.remove('hidden');
      });

      toggle_rt.addEventListener('mouseout', () => {
        document.getElementById('modal').classList.add('hidden');
      });
      
      toggle_rt.addEventListener('click', () => {
        toggle_rt.classList.toggle('off');
        toggle_rt.classList.toggle('on');
        const isOn = toggle_rt.classList.contains('on');
        if (isOn) {
          rt_indicator.innerText = 'ON';
          sample_count.classList.remove('hidden');
          back_button.classList.add('hidden');
          env.classList.add('hidden');
          dispatchEvent(new CustomEvent('start-rt'));
        } else {
          rt_indicator.innerText = 'OFF';
          sample_count.classList.add('hidden');
          back_button.classList.remove('hidden');
          env.classList.remove('hidden');
          dispatchEvent(new CustomEvent('stop-rt'));
        }
      });

      const info_button = document.getElementById('show-info');
      const info = document.getElementById('info');

      info_button.addEventListener('click', () => {
        info.classList.toggle('hidden');
      });

      const selected_button = document.getElementById('selected-bones');

      selected_button.addEventListener('click', () => {
        const selected = document.querySelector('#selected-bones');
        selected.classList.add('hidden');
        toggle_rt.classList.remove('hidden');
        back_button.classList.remove('hidden');
        env.classList.remove('hidden');
        dispatchEvent(new CustomEvent('detailed-view'));
      });

      addEventListener('loaded', () => {
        const loader = document.getElementById('loading');
        loader.classList.add('hidden');
      });

      addEventListener('selected', (event) => {
        const selected = document.querySelector('#selected-bones');
        selected.classList.remove('hidden');
        const title = document.querySelector('#selected-bones h2');
        title.innerText = event.detail.userData.name;
      });

      addEventListener('deselected', () => {
        const selected = document.querySelector('#selected-bones');
        selected.classList.add('hidden');
        const title = document.querySelector('#selected-bones h2');
        title.innerText = '';
      });

      addEventListener('samples', (event) => {
        const selected = document.querySelector('#sample-count');
        selected.innerText = `Samples: ${event.detail.samples}`;
      });
    </script>
  </body>
</html>
